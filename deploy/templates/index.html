<!DOCTYPE html>
<html lang="en">

<!-- Head Section -->
<head>
  <meta charset="UTF-8">
  <title>🌿 Plant Care</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>


<!-- Body Section -->
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-success fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">🌿 PlantCare</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#detect">Detect</a></li>
        <li class="nav-item"><a class="nav-link" href="#store">Store</a></li>
        <li class="nav-item"><a class="nav-link" href="#products">Care Products</a></li>
        <li class="nav-item"><a class="nav-link" href="#devices">Devices</a></li>
        <li class="nav-item"><a class="nav-link" href="#articles-community">Articles & Community</a></li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#cartModal">🛒 Cart (<span id="cartCount">0</span>)</a>
        </li>
        <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#founderModal">👥 Founders</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Toast Notification -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
  <div id="cartToast" class="toast align-items-center text-bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body" id="toastMsg">Added to cart!</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<!-- Cart Modal -->
<div class="modal fade" id="cartModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">🛒 Your Cart</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <table class="table">
          <thead>
            <tr><th>Product</th><th>Price</th><th>Quantity</th><th>Total</th></tr>
          </thead>
          <tbody id="cartItems"></tbody>
        </table>
        <h5 class="text-end">Grand Total: $<span id="grandTotal">0</span></h5>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" onclick="checkout()">Checkout</button>
      </div>
    </div>
  </div>
</div>


<!-- Checkout Modal -->
<div class="modal fade" id="checkoutModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <h4 class="text-success">✅ Payment Successful!</h4>
      <p>Thank you for your purchase.</p>
      <button class="btn btn-success" data-bs-dismiss="modal">OK</button>
    </div>
  </div>
</div>


<!-- Info Modal -->
<div class="modal fade" id="infoModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header bg-white">
        <h5 class="modal-title fw-bold">⚠️ Notice</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body bg-white text-center">
        <h5 class="fw-bold mb-4">
          This model currently detects only <span class="text-danger">15 categories</span>:
        </h5>
        <div class="row justify-content-center">
          <div class="col-md-6">
            <ul class="list-group mb-3">
              <li class="list-group-item">🌱 Pepper__bell___Bacterial_spot</li>
              <li class="list-group-item">🌱 Pepper__bell___healthy</li>
              <li class="list-group-item">🌱 Potato___Early_blight</li>
              <li class="list-group-item">🌱 Potato___Late_blight</li>
              <li class="list-group-item">🌱 Potato___healthy</li>
              <li class="list-group-item">🌱 Tomato_Bacterial_spot</li>
              <li class="list-group-item">🌱 Tomato_Early_blight</li>
            </ul>
          </div>
          <div class="col-md-6">
            <ul class="list-group mb-3">
              <li class="list-group-item">🌱 Tomato_Late_blight</li>
              <li class="list-group-item">🌱 Tomato_Leaf_Mold</li>
              <li class="list-group-item">🌱 Tomato_Septoria_leaf_spot</li>
              <li class="list-group-item">🌱 Tomato_Spider_mites_Two_spotted_spider_mite</li>
              <li class="list-group-item">🌱 Tomato__Target_Spot</li>
              <li class="list-group-item">🌱 Tomato__Tomato_YellowLeaf__Curl_Virus</li>
              <li class="list-group-item">🌱 Tomato__Tomato_mosaic_virus</li>
            </ul>
          </div>
        </div>
        <div class="col-md-6 mx-auto">
          <ul class="list-group">
            <li class="list-group-item">🌱 Tomato_healthy</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Alert Modal -->
  <div class="modal fade" id="alertModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-white">
          <h5 class="modal-title fw-bold text-primary">⚠️ Alert</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center bg-white">
          <p class="fw-bold mb-0">Please select an image before uploading!</p>
        </div>
        <div class="modal-footer bg-white">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>


<!-- Founder Modal -->
<div class="modal fade" id="founderModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">🌿 About Our Founders</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row text-center">

          <div class="col-md-6 mb-4">
            <img src="https://i.pinimg.com/1200x/4e/98/39/4e9839c12d05f7f2b7a2542858d35aa8.jpg" 
                 class="rounded-circle mb-3 shadow" 
                 width="180" height="180">
            <h5 class="fw-bold">Hashibira Inosuke</h5>
            <p class="text-muted mb-1">Co-Founder & CEO (Huster)</p>
            <p>Expert in AI & Computer Vision, passionate about sustainable agriculture.</p>
          </div>
     
          <div class="col-md-6 mb-4">
            <img src="https://i.pinimg.com/736x/45/db/7a/45db7af5918f352e0ed94ed4b2e9b3db.jpg" 
                 class="rounded-circle mb-3 shadow" 
                 width="180" height="180">
            <h5 class="fw-bold">Kanzaki Aoi</h5>
            <p class="text-muted mb-1">Co-Founder & CTO (Neuer)</p>
            <p>Specialist in Plant Science and Technology, dedicated to smart farming solutions.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Detection Section -->
<section id="detect" class="mt-5 pt-3">
  <div id="detect" class="container card p-4 mt-5">
    <div class="d-flex justify-content-between align-items-center">
  <h2 class="mb-4">🌿 Plant Disease Detection</h2>
  <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#infoModal">
    📋 Notes
  </button>
</div>
    <div class="alert alert-info">
      📸 Please upload <b>one clear leaf image</b>. Sharp, well-lit, not blurry.
    </div>
    <div class="mb-3">
      <input type="file" id="fileInput" accept="image/*" class="form-control">
    </div>
    <button class="btn btn-success w-100" onclick="uploadImage()">Upload & Predict</button>
    <div id="result" class="mt-4"></div>
  </div>
</section>


<!-- Store Section -->
<section id="store" class="mt-5 pt-5">
  <h3 class="text-center">🪴 Our Plant Store</h3>
  <div id="plantCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">

       <div class="carousel-item active">
        <div class="d-flex justify-content-center gap-3">
          <div class="card" style="width: 15rem;">
            <img src="https://www.easytogrowbulbs.com/cdn/shop/files/SweetBellPepperPlantinaRaisedBed_Gemini-sqWeb.jpg?v=1739994661" class="card-img-top">
            <div class="card-body text-center">
              <h5 class="card-title">Pepper Bell Plant</h5>
              <p class="card-text">$20</p>
              <button class="btn btn-success" onclick="addToCart('Pepper Bell Plant', 20)">Add to Cart</button>
            </div>
          </div>
          <div class="card" style="width: 15rem;">
            <img src="https://www.knowyourproduce.com/wp-content/uploads/2022/06/how-to-grow-potatoes-7.jpg" class="card-img-top">
            <div class="card-body text-center">
              <h5 class="card-title">Potato Plant</h5>
              <p class="card-text">$25</p>
              <button class="btn btn-success" onclick="addToCart('Potato Plant', 25)">Add to Cart</button>
            </div>
          </div>
          <div class="card" style="width: 15rem;">
            <img src="https://i0.wp.com/savvygardening.com/wp-content/uploads/2023/04/Red-Robin-dwarf-tomato.jpg?resize=600%2C900&ssl=1" class="card-img-top">
            <div class="card-body text-center">
              <h5 class="card-title">Tomato Plant</h5>
              <p class="card-text">$18</p>
              <button class="btn btn-success" onclick="addToCart('Tomato Plant', 18)">Add to Cart</button>
            </div>
          </div>
        </div>
      </div>

      <div class="carousel-item">
        <div class="d-flex justify-content-center gap-3">
          <div class="card" style="width: 15rem;">
            <img src="https://asset.bloomnation.com/c_pad,d_vendor:global:catalog:product:image.png,f_auto,fl_preserve_transparency,q_auto/v1736227584/vendor/2523/catalog/product/2/0/202506132552_file_m5ljwr7fc1316ma" class="card-img-top">
            <div class="card-body text-center">
              <h5 class="card-title">Snake Plant</h5>
              <p class="card-text">$22</p>
              <button class="btn btn-success" onclick="addToCart('Snake Plant', 22)">Add to Cart</button>
            </div>
          </div>
          <div class="card" style="width: 15rem;">
            <img src="https://i.pinimg.com/736x/66/4b/06/664b0649955e0ec864d5192b43b24401.jpg" class="card-img-top">
            <div class="card-body text-center">
              <h5 class="card-title">Spider Plant</h5>
              <p class="card-text">$28</p>
              <button class="btn btn-success" onclick="addToCart('Spider Plant', 28)">Add to Cart</button>
            </div>
          </div>
          <div class="card" style="width: 15rem;">
            <img src="https://cdn.mos.cms.futurecdn.net/d9tY8NNENGY8SEqkPLSAiG.jpg" class="card-img-top">
            <div class="card-body text-center">
              <h5 class="card-title">Money Plant</h5>
              <p class="card-text">$19</p>
              <button class="btn btn-success" onclick="addToCart('Money Plant', 19)">Add to Cart</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#plantCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#plantCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  </div>
</section>


<!-- Products Section -->
  <section id="products" class="mt-5 pt-5">
    <h3 class="text-center">🧴 Plant Care Products</h3>
    <div class="d-flex flex-wrap justify-content-center gap-3">
      <div class="card" style="width: 15rem;">
        <img src="https://www.arbico-organics.com/images/uploads/1305505_tanks_supermix_organic_600x600.jpg" class="card-img-top">
        <div class="card-body text-center">
          <h5 class="card-title">Organic Fertilizer</h5>
          <p class="card-text">$12</p>
          <button class="btn btn-success" onclick="addToCart('Organic Fertilizer', 12)">Add to Cart</button>
        </div>
      </div>
      <div class="card" style="width: 15rem;">
        <img src="https://bitebackproducts.co.uk/cdn/shop/files/SuperFly_insect_repellent_horse_fly_spray.png?v=1739202846&width=1946" class="card-img-top">
        <div class="card-body text-center">
          <h5 class="card-title">Insect Spray</h5>
          <p class="card-text">$15</p>
          <button class="btn btn-success" onclick="addToCart('Insect Spray', 15)">Add to Cart</button>
        </div>
      </div>
      <div class="card" style="width: 15rem;">
        <img src="https://iffcourbangardens.com/cdn/shop/files/Makeyourownpottingmix_6.jpg?v=1714119301" class="card-img-top">
        <div class="card-body text-center">
          <h5 class="card-title">PlantCare Kit</h5>
          <p class="card-text">$36</p>
          <button class="btn btn-success" onclick="addToCart('PlantCare Kit', 36)">Add to Cart</button>
        </div>
      </div>
    </div>
  </section>


<!-- Detection Section -->
<section id="devices" class="mt-5 pt-5">
  <h3 class="text-center">📷 Detection Devices</h3>
  <div class="d-flex flex-wrap justify-content-center gap-3">

    <div class="card" style="width: 18rem;">
      <img src="https://www.dientunhatminh.com/image/data/blogcamera/Micro-Fuvision-Camstick-camera-mini-tot-nhat.jpg" class="card-img-top">
      <div class="card-body text-center">
        <h5 class="card-title">Mini Camera (CNN)</h5>
        <p class="card-text">Basic model, affordable price.</p>
        <div class="mt-auto">
          <p class="fw-bold mb-2">$99</p>
          <button class="btn btn-success" onclick="addToCart('Mini Camera (CNN)', 99)">Add to Cart</button>
        </div>
      </div>
    </div>

    <div class="card" style="width: 18rem;">
      <img src="https://images.unsplash.com/photo-1473968512647-3e447244af8f?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8ZHJvbmUlMjBjYW1lcmF8ZW58MHx8MHx8fDA%3D" class="card-img-top">
      <div class="card-body text-center">
        <h5 class="card-title">Drone Camera (EfficientNetB3)</h5>
        <p class="card-text">High accuracy with Mixup & CutMix.</p>
        <div class="mt-auto">
          <p class="fw-bold mb-2">$299</p>
          <button class="btn btn-success" onclick="addToCart('Drone Camera (EfficientNetB3)', 299)">Add to Cart</button>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- Articles & Community Section -->
<section id="articles-community" class="mt-5 mb-5 container">
  <div class="row">

    <div class="col-md-6">
      <h3 class="text-center mb-4">📚 Articles & Guides</h3>
      <div class="list-group">
        <a href="https://extension.umn.edu/disease-management/tomato-leaf-mold" target="_blank"
           class="list-group-item list-group-item-action">
          🌱 How to Prevent Leaf Mold in Tomato Plants
        </a>
        <a href="https://www.rhs.org.uk/prevention-protection/controlling-pests-and-diseases-without-chemicals" target="_blank"
           class="list-group-item list-group-item-action">
          🐛 Natural Remedies for Common Plant Pests
        </a>
        <a href="https://www.almanac.com/gardening/pests-and-diseases" target="_blank"
           class="list-group-item list-group-item-action">
          🐞 Guide to Common Garden Pests and Diseases
        </a>
      </div>
    </div>

    <div class="col-md-6">
      <h3 class="text-center mb-4">💬 Community Q&A</h3>
      <div class="list-group">
        <button class="list-group-item list-group-item-action"
                data-bs-toggle="modal" data-bs-target="#chatModal"
                onclick="openChat('q1')">
          ❓ What’s the best organic fertilizer for tomato?
        </button>
        <button class="list-group-item list-group-item-action"
                data-bs-toggle="modal" data-bs-target="#chatModal"
                onclick="openChat('q2')">
          ❓ How to control spider mites naturally?
        </button>
        <button class="list-group-item list-group-item-action"
                data-bs-toggle="modal" data-bs-target="#chatModal"
                onclick="openChat('q3')">
          ❓ How often should I water potted plants?
        </button>
      </div>
    </div>
  </div>
</section>


<!-- Chat Modal -->
<div class="modal fade" id="chatModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="chatTitle">💬 Community Discussion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="chatBox" class="border rounded p-3 mb-3" style="height:300px; overflow-y:auto;">
        </div>
        <div class="input-group">
          <input id="chatInput" type="text" class="form-control" placeholder="Type your message...">
          <button class="btn btn-success" onclick="sendMessage()">Send</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>

    window.onload = () => new bootstrap.Modal(document.getElementById('infoModal')).show();

    let currentPredictions = [];
    let currentIndex = 0;

    function uploadImage() {
      const fileInput = document.getElementById("fileInput");
      if (!fileInput.files.length) {
        return new bootstrap.Modal(document.getElementById("alertModal")).show();
      }
      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      document.getElementById("result").innerHTML = `
        <div class="text-center p-4">
          <div class="spinner-border text-success" role="status"></div>
          <p class="mt-2">Analyzing image, please wait...</p>
        </div>
      `;
      fetch("/predict", { method: "POST", body: formData })
        .then(res => res.json())
        .then(data => {
          currentPredictions = data.predictions || [];
          if (!currentPredictions.length) {
            document.getElementById("result").innerHTML = `
              <div class="alert alert-warning text-center">❌ No predictions found!</div>
            `;
            return;
          }
          currentIndex = 0;
          let html = `<div class="row">
                        <div class="col-md-6">
                          <h4>🔎 Top-3 Predictions</h4>
                          <ul class='list-group'>`;
          currentPredictions.forEach(p => {
            html += `<li class="list-group-item d-flex justify-content-between align-items-center">
                      <span>${p.class}</span>
                      <span class="badge bg-primary rounded-pill">${(p.probability*100).toFixed(2)}%</span>
                    </li>`;
          });
          html += `</ul><div id="preview" class="mt-3"></div></div>
                   <div class="col-md-6" id="diseaseInfo"></div></div>`;
          document.getElementById("result").innerHTML = html;
          const reader = new FileReader();
          reader.onload = e => document.getElementById("preview").innerHTML =
            `<img src="${e.target.result}" class="img-fluid rounded shadow d-block mx-auto">`;
          reader.readAsDataURL(fileInput.files[0]);
          showDiseaseInfo(0);
        })
        .catch(() => {
          document.getElementById("result").innerHTML = "<p class='text-danger'>❌ Error predicting!</p>";
        });
    }

    function showDiseaseInfo(index) {
      currentIndex = index;
      const p = currentPredictions[currentIndex];
      const info = p.info || {};
      const html = `
        <h4>📖 Disease Information</h4>
        <h5>${p.class}</h5>
        <div class="mb-5"></div>
        <h6>⚠ Symptoms:</h6>
        <ul class="list-unstyled text-start">
          ${ (info.symptoms || "N/A").split(";").map(s => `<li>• ${s.trim()}</li>`).join("") }
        </ul>
        <h6>🛡 Prevention:</h6>
        <ul class="list-unstyled text-start">
          ${ (info.prevention || "N/A").split(";").map(pv => `<li>✔ ${pv.trim()}</li>`).join("") }
        </ul>
        <div class="d-flex justify-content-between">
          <button class="btn btn-outline-secondary" onclick="prevDisease()">◀</button>
          <button class="btn btn-outline-secondary" onclick="nextDisease()">▶</button>
        </div>`;
      document.getElementById("diseaseInfo").innerHTML = html;
    }

    function prevDisease() {
      showDiseaseInfo((currentIndex - 1 + currentPredictions.length) % currentPredictions.length);
    }
    function nextDisease() {
      showDiseaseInfo((currentIndex + 1) % currentPredictions.length);
    }


let chats = {
  q1: [
    { user: "Anon1", text: "I recommend compost tea, works well for tomatoes." }
  ],
  q2: [
    { user: "Anon2", text: "Neem oil helps a lot with spider mites." }
  ],
  q3: [
    { user: "Anon3", text: "Water every 2-3 days depending on soil dryness." }
  ]
};

let currentRoom = null;

function openChat(roomId) {
  currentRoom = roomId;
  const chatBox = document.getElementById("chatBox");
  const chatTitle = document.getElementById("chatTitle");

  if (roomId === "q1") chatTitle.innerText = "💬 Discussion: Organic fertilizer for tomato";
  if (roomId === "q2") chatTitle.innerText = "💬 Discussion: Spider mites control";
  if (roomId === "q3") chatTitle.innerText = "💬 Discussion: Watering potted plants";

  chatBox.innerHTML = "";
  (chats[roomId] || []).forEach(msg => {
    const p = document.createElement("p");
    p.innerHTML = `<b>${msg.user}:</b> ${msg.text}`;
    chatBox.appendChild(p);
  });
}

function sendMessage() {
  const input = document.getElementById("chatInput");
  const msg = input.value.trim();
  if (!msg || !currentRoom) return;

  const anonName = "Anon" + Math.floor(Math.random() * 1000);
  const newMsg = { user: anonName, text: msg };

  if (!chats[currentRoom]) chats[currentRoom] = [];
  chats[currentRoom].push(newMsg);

  const chatBox = document.getElementById("chatBox");
  const p = document.createElement("p");
  p.innerHTML = `<b>${anonName}:</b> ${msg}`;
  chatBox.appendChild(p);

  input.value = "";
  chatBox.scrollTop = chatBox.scrollHeight;
}
let cart = [];


function addToCart(name, price) {
  let item = cart.find(i => i.name === name);
  if (item) {
    item.qty++;
  } else {
    cart.push({ name, price, qty: 1 });
  }
  document.getElementById("cartCount").innerText = cart.reduce((a, b) => a + b.qty, 0);

  document.getElementById("toastMsg").innerText = `${name} added to cart!`;
  new bootstrap.Toast(document.getElementById("cartToast")).show();

  renderCart();
}


function renderCart() {
  const cartItems = document.getElementById("cartItems");
  cartItems.innerHTML = "";
  let total = 0;
  cart.forEach((item, idx) => {
    let row = `<tr>
      <td>${item.name}</td>
      <td>$${item.price}</td>
      <td>
        <button class="btn btn-sm btn-outline-secondary" onclick="updateQty(${idx}, -1)">-</button>
        <span class="mx-2">${item.qty}</span>
        <button class="btn btn-sm btn-outline-secondary" onclick="updateQty(${idx}, 1)">+</button>
      </td>
      <td>$${(item.price * item.qty).toFixed(2)}</td>
    </tr>`;
    cartItems.innerHTML += row;
    total += item.price * item.qty;
  });
  document.getElementById("grandTotal").innerText = total.toFixed(2);
}

function updateQty(idx, delta) {
  cart[idx].qty += delta;
  if (cart[idx].qty <= 0) cart.splice(idx, 1);
  document.getElementById("cartCount").innerText = cart.reduce((a, b) => a + b.qty, 0);
  renderCart();
}

function checkout() {
  cart = [];
  document.getElementById("cartCount").innerText = 0;
  renderCart();
  new bootstrap.Modal(document.getElementById("checkoutModal")).show();
}

  </script>

</body>

</html>
